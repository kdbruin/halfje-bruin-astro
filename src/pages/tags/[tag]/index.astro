---
//
// All posts belonging to a specific tag
//

import { getCollection } from 'astro:content'
import PostPreviewList from '../../../components/PostPreviewList.astro'
import DefaultPageLayout from '../../../layouts/default.astro'
import { getTags, sortPostsDescending } from '../../../utils'

export async function getStaticPaths({}) {
    const allPosts = await getCollection('blog')
    const allTags = getTags(allPosts)

    return allTags.flatMap((tag) => {
        const filteredPosts = allPosts.filter((post) =>
            post.data.tags?.includes(tag)
        )
        return {
            params: { tag },
            props: {
                posts: sortPostsDescending(filteredPosts),
            },
        }
    })
}

const { posts } = Astro.props
const { tag } = Astro.params
---

<DefaultPageLayout
    content={{
        title: `Berichten met tag: ${tag}`,
        description: `alle berichten met de tag: ${tag}`,
    }}
>
    <PostPreviewList posts={posts} />
</DefaultPageLayout>
