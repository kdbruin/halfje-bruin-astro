---
import { getCollection } from 'astro:content'
import PostPreviewList from '../../../components/PostPreviewList.astro'
import DefaultPageLayout from '../../../layouts/default.astro'
import { getCategories } from '../../../utils'

export async function getStaticPaths({}) {
    const allPosts = await getCollection('blog')
    const allCategories = getCategories(allPosts)

    return allCategories.flatMap((category) => {
        const filteredPosts = allPosts.filter((post) =>
            post.data.category === category
        )
        return {
            params: { category: category },
            props: {
                pages: filteredPosts,
            },
        }
    })
}

const { pages } = Astro.props
const { category } = Astro.params
---

<DefaultPageLayout
    content={{
        title: `Berichten uit de category: ${category}`,
        description: `alle berichten uit de categorie: ${category}`,
    }}
>
    <PostPreviewList posts={pages} />
</DefaultPageLayout>
